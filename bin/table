#!/usr/bin/env node

var _ = require('lodash')
var fs = require('fs')
var mkdirp = require('mkdirp')
var path = require('path')
var rimraf = require('rimraf')
var errors = require('../lib/index.js')
var header = ['Code', 'Description']

var sizes = _.map(header, function(title) {
  return title.length
})

_.forEach(errors.Codes, function(error) {
  sizes[0] = sizes[0] < String(error.code).length ? String(error.code).length : sizes[0]
  sizes[1] = sizes[1] < String(error.type).length ? String(error.type).length : sizes[1]
})

sizes[0]++
sizes[0] += 13
sizes[1]++

var table = ''
table += '| ' + header[0] + Array(sizes[0] - header[0].length).join(' ') + ' | ' + header[1] + Array(sizes[1] - header[1].length).join(' ') + ' |' + "\n"
table += '|-' + Array(sizes[0]).join('-') + '-|:' + Array(sizes[1]).join('-') + '-|' + "\n"

var group = '1'

_.forEach(errors.Codes, function(error) {
  if (String(error.code).substr(0, 1) !== group) {
    group = String(error.code).substr(0, 1)
    table += '|-' + Array(sizes[0]).join(' ') + ' |-' + Array(sizes[1]).join(' ') + ' |' + "\n"
  }

  table += '| ' + '<code>' + error.code + '</code>' + Array(sizes[0] - String(error.code).length - 13).join(' ') + ' | ' + error.type + Array(sizes[1] - String(error.message).length).join(' ') + ' |' + "\n"
})

rimraf('docs', function(err) {
  if (err) {
    return console.error(err)
  }

  mkdirp('docs', function(err) {
    if (err) {
      return console.error(err)
    }

    fs.writeFile('docs/table.md', table, function(err) {
      if (err) {
        return console.error(err)
      }
    })
  })
})
